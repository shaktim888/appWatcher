(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["tableAdmin"],{"19e6":function(e,t,a){"use strict";var l=a("8235"),n=a.n(l);n.a},"4cc4":function(e,t,a){"use strict";a.r(t);var l=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"crumbs"},[a("el-breadcrumb",{attrs:{separator:"/"}},[a("el-breadcrumb-item",[a("i",{staticClass:"el-icon-lx-cascades"}),e._v(" 基础表格\n            ")])],1)],1),a("div",{staticClass:"container"},[a("div",{staticClass:"handle-box"},[a("el-button",{staticClass:"mr10",attrs:{type:"primary",icon:"el-icon-plus"},on:{click:e.addNewTable}},[e._v("新建表结构")]),a("el-autocomplete",{staticClass:"inline-input handle-input mr10",attrs:{"fetch-suggestions":e.querySearch,placeholder:"输入表名"},on:{select:e.handleSelect},model:{value:e.query.tableName,callback:function(t){e.$set(e.query,"tableName",t)},expression:"query.tableName"}}),a("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.handleSearch}},[e._v("搜索")])],1),a("el-table",{staticClass:"table",attrs:{data:e.tableData,border:"","header-cell-class-name":"table-header"},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{prop:"tableName",label:"表名"}}),a("el-table-column",{attrs:{label:"数据列信息"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-table",{staticClass:"innerTable",attrs:{border:"",data:t.row.fields,"show-header":!1,"max-height":"300","header-cell-class-name":"table-header"}},[a("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.desc))])]}}],null,!0)}),a("el-table-column",{attrs:{prop:"fieldName",label:"字段名",align:"center"}}),a("el-table-column",{attrs:{prop:"type",label:"类型",align:"center"}}),a("el-table-column",{attrs:{label:"是否必填",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.required?a("el-checkbox",{attrs:{disabled:""},model:{value:t.row.required,callback:function(a){e.$set(t.row,"required",a)},expression:"scope.row.required"}},[e._v("必填")]):e._e()]}}],null,!0)})],1)]}}])}),a("el-table-column",{attrs:{label:"操作",width:"180",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",icon:"el-icon-edit"},on:{click:function(a){return e.handleEdit(t.$index,t.row)}}},[e._v("编辑")]),a("el-button",{staticClass:"red",attrs:{type:"text",icon:"el-icon-delete"},on:{click:function(a){return e.handleDelete(t.$index,t.row)}}},[e._v("删除")])]}}])})],1),a("div",{staticClass:"pagination"},[a("el-pagination",{attrs:{background:"",layout:"total, prev, pager, next","current-page":e.query.pageIndex,"page-size":e.query.pageSize,total:e.pageTotal},on:{"current-change":e.handlePageChange}})],1)],1),a("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],attrs:{title:"新建表结构",visible:e.createVisible,width:"30%"},on:{"update:visible":function(t){e.createVisible=t}}},[a("el-form",{attrs:{model:e.createForm,"label-width":"70px"}},[a("el-form-item",{attrs:{label:"表名"}},[a("el-input",{model:{value:e.createForm.tableName,callback:function(t){e.$set(e.createForm,"tableName",t)},expression:"createForm.tableName"}})],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.createVisible=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.confirmAddTable}},[e._v("确 定")])],1)],1),a("el-dialog",{attrs:{fullscreen:"",title:"编辑表结构",visible:e.editVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.editVisible=t}}},[a("div",{staticClass:"handle-box"},[a("el-button",{staticClass:"mr10",attrs:{type:"primary",icon:"el-icon-plus"},on:{click:e.addNewField}},[e._v("添加字段")]),a("el-input",{staticClass:"inline-input handle-input mr10",attrs:{placeholder:"输入表名"},model:{value:e.editForm.tableName,callback:function(t){e.$set(e.editForm,"tableName",t)},expression:"editForm.tableName"}})],1),a("el-table",{staticClass:"innerTable",attrs:{border:"",data:e.editForm.fields,height:"400","header-cell-class-name":"table-header"}},[a("el-table-column",{attrs:{label:"字段名",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{attrs:{placeholder:"请输入内容"},model:{value:t.row.fieldName,callback:function(a){e.$set(t.row,"fieldName",a)},expression:"scope.row.fieldName"}})]}}])}),a("el-table-column",{attrs:{prop:"type",label:"类型",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-select",{attrs:{placeholder:"请选择"},model:{value:t.row.type,callback:function(a){e.$set(t.row,"type",a)},expression:"scope.row.type"}},e._l(e.options,(function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),1)]}}])}),a("el-table-column",{attrs:{label:"是否界面显示",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-checkbox",{model:{value:t.row.required,callback:function(a){e.$set(t.row,"required",a)},expression:"scope.row.required"}},[e._v("是否必填")])]}}])}),a("el-table-column",{attrs:{label:"描述",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{attrs:{placeholder:"请输入描述"},model:{value:t.row.desc,callback:function(a){e.$set(t.row,"desc",a)},expression:"scope.row.desc"}})]}}])}),a("el-table-column",{attrs:{label:"操作",width:"180",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{staticClass:"red",attrs:{type:"text",icon:"el-icon-delete"},on:{click:function(a){return e.handleDeleteField(t.$index,t.row)}}},[e._v("删除")])]}}])})],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.editVisible=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.saveEdit}},[e._v("应 用")])],1)],1)],1)},n=[],i=(a("ac6a"),a("ac4d"),a("8a81"),a("5df3"),a("1c4c"),a("6b54"),a("7f7f"),a("365c"));function r(e){if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=o(e))){var t=0,a=function(){};return{s:a,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,n,i=!0,r=!1;return{s:function(){l=e[Symbol.iterator]()},n:function(){var e=l.next();return i=e.done,e},e:function(e){r=!0,n=e},f:function(){try{i||null==l.return||l.return()}finally{if(r)throw n}}}}function o(e,t){if(e){if("string"===typeof e)return c(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?c(e,t):void 0}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,l=new Array(t);a<t;a++)l[a]=e[a];return l}var s={name:"TableManager",data:function(){return{options:["string","boolean","number","array"],queryList:[],query:{tableName:"",pageIndex:1,pageSize:10},tableData:[],multipleSelection:[],multipleFieldSelection:[],delList:[],createVisible:!1,editVisible:!1,pageTotal:0,editForm:{},createForm:{tableName:""},idx:-1,id:-1}},created:function(){this.getData()},methods:{handleSelect:function(e){this.query.tableName=e.tableName},createFilter:function(e){return function(t){return console.log(t.tableName.toLowerCase()),t.tableName.toLowerCase().indexOf(e.toLowerCase())>=0}},querySearch:function(e,t){var a=this;i["c"].getTableNameList().then((function(l){a.queryList.splice(0);var n,i=r(l);try{for(i.s();!(n=i.n()).done;){var o=n.value;a.queryList.push({value:o.tableName,tableName:o.tableName})}}catch(u){i.e(u)}finally{i.f()}var c=a.queryList,s=e?c.filter(a.createFilter(e)):c;t(s)}))},addNewTable:function(){this.createVisible=!0},confirmAddTable:function(){var e=this,t=this.$loading({fullscreen:!0});i["c"].createTable(this.createForm).then((function(a){t.close(),e.$message.success("创建成功"),e.createVisible=!1,e.getData()})).catch((function(a){e.$message.error(a||"创建失败"),t.close()}))},getData:function(){var e=this;i["c"].queryTables(this.query).then((function(t){console.log(t),e.tableData=t.rows,e.pageTotal=t.count||50}))},handleSelectionFieldChange:function(e){console.log(e),this.multipleFieldSelection=e},handleDeleteField:function(e,t){var a=this;this.$confirm("确定要删除吗？","提示",{type:"warning"}).then((function(){a.editForm.fields.splice(e,1)})).catch((function(){}))},handleSearch:function(){this.$set(this.query,"pageIndex",1),this.getData()},handleDelete:function(e,t){var a=this;this.$confirm("确定要删除吗？","提示",{type:"warning"}).then((function(){i["c"].removeTable({id:t.id}).then((function(){a.$message.success("删除成功"),a.tableData.splice(e,1)})).catch((function(e){a.$message.error(e||"删除失败"),console.log(e)}))})).catch((function(){}))},addNewField:function(){this.editForm.fields.push({type:"string",required:!1,fieldName:"newField",desc:""})},handleSelectionChange:function(e){console.log(e),this.multipleSelection=e},delAllSelection:function(){var e=this.multipleSelection.length,t="";this.delList=this.delList.concat(this.multipleSelection);for(var a=0;a<e;a++)t+=this.multipleSelection[a].name+" ";this.$message.error("删除了".concat(t)),this.multipleSelection=[]},handleEdit:function(e,t){this.idx=e,this.editForm=JSON.parse(JSON.stringify(t)),this.editVisible=!0},saveEdit:function(){var e=this;this.$confirm("确定要应用修改吗？","提示",{type:"warning"}).then((function(){e.editVisible=!1;var t,a=e.tableData[e.idx],l=JSON.parse(JSON.stringify(e.editForm)),n=[],o=r(a.fields);try{for(o.s();!(t=o.n()).done;){var c,s=t.value,u=!1,d=r(e.editForm.fields);try{for(d.s();!(c=d.n()).done;){var f=c.value;if(s.id==f.id){u=!0;break}}}catch(b){d.e(b)}finally{d.f()}u||n.push(s.id)}}catch(b){o.e(b)}finally{o.f()}l.removeList=n,i["c"].updateTableInfo(l).then((function(){e.$set(e.tableData,e.idx,e.editForm),e.$message.success("修改第 ".concat(e.idx+1," 行成功"))})).catch((function(t){e.$message.error(t||"注册失败")}))})).catch((function(){}))},handlePageChange:function(e){this.$set(this.query,"pageIndex",e),this.getData()}}},u=s,d=(a("19e6"),a("2877")),f=Object(d["a"])(u,l,n,!1,null,"dd94bb2a",null);t["default"]=f.exports},8235:function(e,t,a){}}]);