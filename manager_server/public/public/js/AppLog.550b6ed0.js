(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["AppLog"],{"028a":function(t,e,a){"use strict";var i=a("720c"),n=a.n(i);n.a},"4f04":function(t,e,a){"use strict";var i=a("5c67"),n=a.n(i);n.a},"5c67":function(t,e,a){},"720c":function(t,e,a){},de8d:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"crumbs"},[a("el-breadcrumb",{attrs:{separator:"/"}},[a("el-breadcrumb-item",[a("i",{staticClass:"el-icon-lx-cascades"}),t._v(" 基础表格\n            ")])],1)],1),a("div",{staticClass:"container"},[a("div",{staticClass:"handle-box"},[a("el-date-picker",{staticClass:"mr10",attrs:{type:"date",placeholder:"起始日期"},model:{value:t.query.starttime,callback:function(e){t.$set(t.query,"starttime",e)},expression:"query.starttime"}}),a("el-date-picker",{staticClass:"mr10",attrs:{type:"date",placeholder:"结束日期"},model:{value:t.query.endtime,callback:function(e){t.$set(t.query,"endtime",e)},expression:"query.endtime"}}),a("el-autocomplete",{staticClass:"inline-input handle-input mr10",attrs:{"fetch-suggestions":t.querySearch,placeholder:"输入bundleID"},on:{select:t.handleSelect},model:{value:t.query.bid,callback:function(e){t.$set(t.query,"bid",e)},expression:"query.bid"}}),a("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:t.handleSearch}},[t._v("搜索")])],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"multipleTable",staticClass:"table",attrs:{data:t.tableData,border:"",stripe:"","header-cell-class-name":"table-header"},on:{"selection-change":t.handleSelectionChange}},[a("el-table-column",{attrs:{prop:"uuid",label:"访问标识",align:"center",width:"180"}}),a("el-table-column",{attrs:{prop:"ip",label:"访问的ip",align:"center",width:"180"}}),a("el-table-column",{attrs:{prop:"bid",label:"bundleID",align:"center",width:"180"}}),a("el-table-column",{attrs:{label:"设备信息",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-table",{staticClass:"innerTable",attrs:{border:"",data:t.parseTable(e.row.deviceData),"max-height":"200","show-header":!1,"header-cell-class-name":"table-header"}},[a("el-table-column",{attrs:{prop:"key",label:"字段名",align:"center"}}),a("el-table-column",{attrs:{label:"值",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return["lt"==e.row.key?a("p",[t._v(t._s(t._f("formatDate")(1e3*e.row.value)))]):a("p",[t._v(t._s(e.row.value))])]}}],null,!0)})],1)]}}])}),a("el-table-column",{attrs:{label:"时间",align:"center",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("p",[t._v(t._s(t._f("formatDate")(e.row.createdAt)))])]}}])}),a("el-table-column",{attrs:{label:"操作",align:"center",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"text",icon:"el-icon-s-unfold"},on:{click:function(a){return t.handleOpenDetail(e.$index,e.row)}}},[t._v("查看信息")])]}}])})],1),a("div",{staticClass:"pagination"},[a("el-pagination",{attrs:{background:"",layout:"total, prev, pager, next","current-page":t.query.pageIndex,"page-size":t.query.pageSize,total:t.pageTotal},on:{"current-change":t.handlePageChange}})],1),a("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],attrs:{title:"查看事件",visible:t.dialogVisible,width:"80%"},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("el-switch",{attrs:{"active-text":"横屏","inactive-text":"竖屏"},model:{value:t.isLandscape,callback:function(e){t.isLandscape=e},expression:"isLandscape"}}),a("el-container",{directives:[{name:"loading",rawName:"v-loading",value:t.dialogLoading,expression:"dialogLoading"}],staticStyle:{height:"500px","margin-top":"20px"}},[a("div",{staticClass:"handle-box"},[a("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:t.queryEventList}},[t._v("刷新")])],1),a("el-aside",{attrs:{width:"300px"}},[a("el-steps",{attrs:{direction:"vertical",space:"60px"}},t._l(t.allEvents,(function(e,i){return a("el-step",{key:i,attrs:{status:t.getStepStatus(e),title:e.name,description:t._f("formatDate")(e.createdAt)},nativeOn:{click:function(a){return t.clickedOneItem(e)}}})})),1)],1),a("el-main",[t.mainInfo.name?a("el-form",{attrs:{"label-position":"left","label-width":"80px"}},[a("el-form-item",{attrs:{label:"事件名"}},[a("p",[t._v(t._s(t.mainInfo.name))])]),a("el-form-item",{attrs:{label:"时间"}},[a("p",[t._v(t._s(t._f("formatDate")(t.mainInfo.createdAt)))])]),t.checkisinput(t.mainInfo)?a("el-form-item",{attrs:{label:"点击位置"}},[a("phone-canvas",{attrs:{landscape:t.isLandscape,mobileWidth:t.mobileWidth,mobileHeight:t.mobileHeight,pos:JSON.parse(t.mainInfo.data).pos}})],1):t._e(),a("el-form-item",{attrs:{label:"数据"}},[t.mainInfo.data?a("json-viewer",{attrs:{value:JSON.parse(t.mainInfo.data),"expand-depth":5,sort:""}}):a("p",[t._v("无数据")])],1)],1):a("el-alert",{attrs:{title:"点击左侧可以显示详细信息",type:"error",closable:!1}})],1)],1),a("el-alert",{attrs:{title:"点击左侧可以显示详细信息",type:"success",closable:!1}})],1)],1)])},n=[],r=(a("ac6a"),a("2caf"),a("ac4d"),a("8a81"),a("5df3"),a("1c4c"),a("6b54"),a("87b3"),a("d25f"),a("57e7"),a("55dd"),a("7f7f"),a("365c")),l=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{ref:"containDiv"},[a("canvas",{ref:"phone-canvas"})])},s=[];a("c5f6"),a("7ed4");function o(t){if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=c(t))){var e=0,a=function(){};return{s:a,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,n,r=!0,l=!1;return{s:function(){i=t[Symbol.iterator]()},n:function(){var t=i.next();return r=t.done,t},e:function(t){l=!0,n=t},f:function(){try{r||null==i.return||i.return()}finally{if(l)throw n}}}}function c(t,e){if(t){if("string"===typeof t)return u(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);return"Object"===a&&t.constructor&&(a=t.constructor.name),"Map"===a||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?u(t,e):void 0}}function u(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,i=new Array(e);a<e;a++)i[a]=t[a];return i}var d={data:function(){return{background:"#fff",ctx:null,width:0,height:0}},props:{landscape:{type:Boolean,required:!0},canvasWidth:{type:Number},canvasHeight:{type:Number},mobileWidth:{type:Number,required:!0},mobileHeight:{type:Number,required:!0},pos:{type:Array,required:!0}},watch:{pos:function(t){this.draw()},landscape:function(t){this.draw()}},methods:{draw:function(){var t=this.mobileWidth,e=this.mobileHeight;if(this.landscape){if(t<e){var a=t;t=e,e=a}}else if(t>e){var i=t;t=e,e=i}console.log(t,e),this.canvas=this.$refs["phone-canvas"],this.width=this.canvasWidth||this.width,this.height=this.canvasHeight||this.height,this.canvas.width=this.width,this.canvas.height=this.height,this.canvas.style.background=this.background,this.canvas.getContext?this.ctx=this.canvas.getContext("2d"):this.$message("您的浏览器不支持canvas绘画环境");var n=1;t>this.width-10&&(n=Math.min((this.width-10)/t,n)),e>this.height-10&&(n=Math.min((this.height-10)/e,n)),this.ctx.clearRect(0,0,this.width,this.height),this.ctx.beginPath(),this.ctx.rect(5,5,t*n,e*n),this.ctx.stroke();var r,l=o(this.pos);try{for(l.s();!(r=l.n()).done;){var s=r.value;this.ctx.beginPath(),this.ctx.arc(s.x*n+5,s.y*n+5,5,0,2*Math.PI),this.ctx.stroke()}}catch(c){l.e(c)}finally{l.f()}}},mounted:function(){var t=this.$refs["containDiv"];this.width=this.canvasWidth||t.offsetWidth,this.height=this.canvasHeight||t.offsetHeight,this.draw()}},h=d,f=(a("4f04"),a("2877")),p=Object(f["a"])(h,l,s,!1,null,"cbf571fc",null),m=p.exports;function b(t){if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=g(t))){var e=0,a=function(){};return{s:a,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,n,r=!0,l=!1;return{s:function(){i=t[Symbol.iterator]()},n:function(){var t=i.next();return r=t.done,t},e:function(t){l=!0,n=t},f:function(){try{r||null==i.return||i.return()}finally{if(l)throw n}}}}function g(t,e){if(t){if("string"===typeof t)return v(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);return"Object"===a&&t.constructor&&(a=t.constructor.name),"Map"===a||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?v(t,e):void 0}}function v(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,i=new Array(e);a<e;a++)i[a]=t[a];return i}var y={name:"LogManager",data:function(){var t={mobileWidth:0,mobileHeight:0,isLandscape:!0,mainInfo:{},currentID:0,allEvents:[],dialogLoading:!1,dialogVisible:!1,bidList:[],query:{bid:"",starttime:"",endtime:"",pageIndex:1,pageSize:5},tableData:[],multipleSelection:[],delList:[],editVisible:!1,pageTotal:0,form:{},idx:-1,id:-1,loading:!1};return t},components:{phoneCanvas:m},created:function(){this.getData()},methods:{checkisinput:function(t){return!(this.mobileWidth<=0||this.mobileHeight<=0)&&("input"==t.name||"click"==t.name)},getStepStatus:function(t){return t.id==this.mainInfo.id?"finish":"process"},parseTable:function(t){t=JSON.parse(t);var e=[],a={w:100,h:101,idfa:1,tz:2,lt:3,lang:4,net:5,device:6,phone:7,version:8};for(var i in t)e.push({key:i,value:t[i]});var n=99;return e.sort((function(t,e){return(a[t.key]||n)-(a[e.key]||n)})),e},handleSelect:function(t){this.query.bid=t.bid},createFilter:function(t){return function(e){return e.bid.toLowerCase().indexOf(t.toLowerCase())>=0}},querySearch:function(t,e){var a=this;if(0==this.bidList.length)r["a"].getBidList().then((function(i){var n,r=b(i);try{for(r.s();!(n=r.n()).done;){var l=n.value;l.bid&&a.bidList.push({value:l.bid,bid:l.bid})}}catch(c){r.e(c)}finally{r.f()}var s=a.bidList,o=t?s.filter(a.createFilter(t)):s;e(o)}));else{var i=this.bidList,n=t?i.filter(this.createFilter(t)):i;e(n)}},getData:function(){var t=this;this.loading=!0,r["a"].queryAppLogs(this.query).then((function(e){t.loading=!1,t.tableData=e.rows,t.pageTotal=e.count||50}))},handleSearch:function(){this.$set(this.query,"pageIndex",1),this.getData()},handleDelete:function(t,e){var a=this;this.$confirm("确定要删除吗？","提示",{type:"warning"}).then((function(){a.$message.success("删除成功"),a.tableData.splice(t,1)})).catch((function(){}))},handleSelectionChange:function(t){this.multipleSelection=t},clickedOneItem:function(t){this.mainInfo=t},delAllSelection:function(){var t=this.multipleSelection.length,e="";this.delList=this.delList.concat(this.multipleSelection);for(var a=0;a<t;a++)e+=this.multipleSelection[a].name+" ";this.$message.error("删除了".concat(e)),this.multipleSelection=[]},queryEventList:function(){var t=this;this.dialogLoading=!0,r["a"].getEvents({id:this.currentID}).then((function(e){t.dialogLoading=!1,t.allEvents=e})).catch((function(){t.dialogLoading=!1}))},handleOpenDetail:function(t,e){this.currentID=e.id,this.dialogVisible=!0,this.mainInfo={};var a=JSON.parse(e.deviceData);this.mobileWidth=a.w||0,this.mobileHeight=a.h||0,this.isLandscape=this.mobileWidth>this.mobileHeight,this.queryEventList()},handlePageChange:function(t){this.$set(this.query,"pageIndex",t),this.getData()}}},w=y,x=(a("028a"),Object(f["a"])(w,i,n,!1,null,"5f02c206",null));e["default"]=x.exports}}]);